<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Un instant ‚ú®</title>

<style>
  :root{
    --bg1:#0b1220;
    --bg2:#020617;
    --glass: rgba(255,255,255,0.06);
    --border: rgba(255,255,255,0.12);
    --shadow: 0 24px 80px rgba(0,0,0,0.70);
    --soft: rgba(255,255,255,0.10);
  }

  body{
    margin:0;
    font-family:-apple-system, system-ui;
    background:
      radial-gradient(900px 520px at 15% 18%, rgba(168,85,247,0.20), transparent 55%),
      radial-gradient(780px 520px at 85% 25%, rgba(34,197,94,0.14), transparent 55%),
      radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
  }

  .container{
    width:92%;
    max-width:720px;
    background: var(--glass);
    padding:24px;
    border-radius:24px;
    text-align:center;
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    border: 1px solid var(--border);
    position: relative;
  }

  .topbar{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    margin-bottom:10px;
  }

  .pill{
    display:inline-flex;
    gap:8px;
    align-items:center;
    padding:7px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.18);
    font-size:12px;
    opacity:.92;
  }

  .soundBtn{
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,0.10);
    color:white;
    cursor:pointer;
    font-size:12px;
    transition:.18s;
  }
  .soundBtn:hover{ background: rgba(255,255,255,0.14); transform: translateY(-1px); }

  .heroTitle{
    font-size:34px;
    margin: 10px 0 6px;
    letter-spacing: 0.2px;
    text-shadow: 0 0 18px rgba(255,255,255,0.25);
  }

  .heroSub{
    opacity:.86;
    font-size:14px;
    line-height:1.5;
    margin-bottom: 14px;
  }

  .title{
    font-size:30px;
    margin: 8px 0 10px;
    min-height:42px;
    text-shadow: 0 0 14px rgba(255,255,255,0.32);
  }

  .text{
    line-height:1.75;
    font-size:16px;
    opacity:1;
    white-space:pre-wrap;
    min-height: 200px;
    text-align:left;
    padding: 12px 14px;
    border-radius: 16px;
    background: rgba(0,0,0,0.14);
    border: 1px solid rgba(255,255,255,0.12);
  }

  .hint{
    margin-top: 10px;
    opacity: .72;
    font-size: 12px;
  }

  .grid{ display:grid; gap:10px; margin-top:14px; }

  button.main{
    width:100%;
    padding:14px 14px;
    border-radius:16px;
    border:none;
    background:white;
    color:black;
    font-size:16px;
    cursor:pointer;
    transition:0.18s;
    font-weight: 700;
  }
  button.main:hover{ background:#e2e8f0; transform:translateY(-1px); }

  .btnSoft{
    width:100%;
    padding:14px 14px;
    border-radius:16px;
    background: rgba(255,255,255,0.10);
    color:white;
    border: 1px solid rgba(255,255,255,0.16);
    cursor:pointer;
    transition:.18s;
    font-size:16px;
  }
  .btnSoft:hover{ background: rgba(255,255,255,0.14); transform:translateY(-1px); }

  .chips{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    margin-top:12px;
  }
  .chip{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.08);
    cursor:pointer;
    font-size:14px;
    transition:.15s;
    user-select:none;
  }
  .chip:hover{ background: rgba(255,255,255,0.12); transform: translateY(-1px); }
  .chip.selected{
    background: rgba(168,85,247,0.18);
    border-color: rgba(168,85,247,0.35);
  }

  .progress{
    margin-top:10px;
    font-size:12px;
    opacity:.78;
  }

  .star{
    position:absolute;
    color:white;
    animation: float 6s infinite linear;
    opacity:0.12;
    user-select:none;
    pointer-events:none;
  }
  @keyframes float{
    from{ transform:translateY(110vh); }
    to{ transform:translateY(-15vh); }
  }
</style>
</head>

<body>
<div class="container">
  <div class="topbar">
    <div class="pill" id="stagePill">‚ú® Un instant</div>
    <button class="soundBtn" id="soundBtn">üîä Activer le son</button>
  </div>

  <div id="screen"></div>

  <div class="hint" id="hint"></div>
</div>

<script>
  const SON_PRENOM = "Bambi";

  const stagePill = document.getElementById("stagePill");
  const screen = document.getElementById("screen");
  const hintEl = document.getElementById("hint");
  const soundBtn = document.getElementById("soundBtn");

  let step = 0;
  let words = [];

  // --- Son optionnel ---
  let audioCtx = null, osc = null, gain = null, isSoundOn = false;

  function startSound(){
    if(isSoundOn) return;
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    osc = audioCtx.createOscillator();
    gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = 174;
    gain.gain.value = 0.00001;
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start();
    const now = audioCtx.currentTime;
    gain.gain.setValueAtTime(0.00001, now);
    gain.gain.linearRampToValueAtTime(0.02, now + 0.25);
    isSoundOn = true;
    soundBtn.textContent = "üîá Couper le son";
  }
  function stopSound(){
    if(!isSoundOn) return;
    try{
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(gain.gain.value, now);
      gain.gain.linearRampToValueAtTime(0.00001, now + 0.20);
      setTimeout(()=>{
        if(osc){ osc.stop(); osc.disconnect(); }
        if(gain){ gain.disconnect(); }
        osc=null; gain=null;
      }, 220);
    }catch(e){}
    isSoundOn=false;
    soundBtn.textContent="üîä Activer le son";
  }
  soundBtn.onclick = async () => {
    if(!isSoundOn){
      startSound();
      if(audioCtx && audioCtx.state === "suspended") await audioCtx.resume();
    } else stopSound();
  };

  // ‚úÖ M√©taphores coh√©rentes
  function metaphorFor(word){
    const w = (word || "").toLowerCase();
    const map = {
      "romantique": "comme une lettre scell√©e qu‚Äôon ouvre lentement",
      "loyale": "comme une main qui ne l√¢che pas, m√™me quand la nuit tombe",
      "douce": "comme une pluie ti√®de qui apaise sans faire de bruit",
      "myst√©rieuse": "comme une lueur derri√®re un rideau, qu‚Äôon devine sans la saisir",
      "solaire": "comme un matin clair qui r√©chauffe tout autour de lui",
      "√©l√©gante": "comme un parfum rare, discret mais inoubliable",
      "spontan√©e": "comme un √©clat de rire qui arrive sans pr√©venir",
      "calme": "comme un lac tranquille o√π l‚Äôon respire mieux",
      "rieuse": "comme une lumi√®re qui danse sur les murs",
      "intense": "comme un feu doux qui ne s‚Äô√©teint pas",
      "curieuse": "comme une porte entrouverte sur mille possibles",
      "audacieuse": "comme un pas en avant, m√™me quand le c≈ìur h√©site",
      "sensible": "comme une peau qui ressent le monde plus fort",
      "sereine": "comme une paix qu‚Äôon n‚Äôexplique pas, qu‚Äôon reconna√Æt",
      "magn√©tique": "comme une gravit√© discr√®te qui attire sans effort",
      "vraie": "comme un regard franc, sans masque et sans d√©tour"
    };
    return map[w] || "comme un secret qu‚Äôon garde au creux de la nuit";
  }

  function poemFromWords(name, words){
    const pick = (i, fallback) => (words[i] ? words[i].toLowerCase() : fallback);

    const w1 = pick(0, "romantique");
    const w2 = pick(1, "myst√©rieuse");
    const w3 = pick(2, "douce");

    const m1 = metaphorFor(w1);
    const m2 = metaphorFor(w2);
    const m3 = metaphorFor(w3);

    return `${name},\n\n` +
`Tu es ${w1} ‚Äî ${m1}.\n` +
`Tu es ${w2} ‚Äî ${m2}.\n` +
`Et ${w3}‚Ä¶ ${m3}.\n\n` +
`Trois mots‚Ä¶\n` +
`et mon silence devient une lettre.\n` +
`Trois mots‚Ä¶\n` +
`et l‚Äôinstant prend ton parfum.`;
  }

  // --- Typing rapide (po√®me qui s‚Äô√©crit) ---
  function typeInto(el, fullText, speed=16, done=()=>{}){
    el.textContent = "";
    let i = 0;
    (function tick(){
      el.textContent += fullText[i++] || "";
      if(i <= fullText.length){
        setTimeout(tick, speed);
      } else done();
    })();
  }

  function showHome(){
    step = 0;
    stagePill.textContent = "‚ú® Accueil";
    hintEl.textContent = "Promis : c‚Äôest court, doux‚Ä¶ et diff√©rent.";

    screen.innerHTML = `
      <div class="heroTitle">Un instant pour toi</div>
      <div class="heroSub">
        <b>${SON_PRENOM}</b>, j‚Äôai gliss√© quelque chose ici.<br/>
        √áa se lit comme une petite sc√®ne‚Ä¶ et √ßa finit en po√©sie.
      </div>
      <div class="grid">
        <button class="main" id="openBtn">Ouvrir ‚ú®</button>
        <button class="btnSoft" id="skipBtn">Aller directement au po√®me</button>
      </div>
      <div class="progress">üí´ 2 pages : Po√®me ‚Üí Derni√®re page</div>
    `;

    document.getElementById("openBtn").onclick = showPoemSetup;
    document.getElementById("skipBtn").onclick = showPoemSetup;
  }

  function showPoemSetup(){
    step = 1;
    stagePill.textContent = "üìù Po√®me";
    hintEl.textContent = "Choisis 3 mots. Le po√®me appara√Æt imm√©diatement.";

    words = [];

    screen.innerHTML = `
      <div class="title">${SON_PRENOM}‚Ä¶</div>
      <div class="heroSub" style="margin-top:-4px">
        Choisis <b>trois mots</b> qui te ressemblent.<br/>
        Je les transforme en po√©sie.
      </div>
      <div class="chips" id="chips"></div>
      <div class="progress" id="count">0 / 3 s√©lectionn√©s</div>
      <div class="text" id="poemBox">‚Ä¶</div>
      <div class="grid">
        <button class="main" id="toFinalBtn" style="display:none">Voir la derni√®re page</button>
      </div>
    `;

    const pool = [
      "Romantique","Loyale","Douce","Myst√©rieuse","Solaire","√âl√©gante",
      "Spontan√©e","Calme","Rieuse","Intense","Curieuse","Audacieuse",
      "Sensible","Sereine","Magn√©tique","Vraie"
    ];

    const chips = document.getElementById("chips");
    const count = document.getElementById("count");
    const poemBox = document.getElementById("poemBox");
    const toFinalBtn = document.getElementById("toFinalBtn");

    chips.innerHTML = pool.map(w => `<div class="chip" data-w="${w}">${w}</div>`).join("");

    function refreshPoem(){
      if(words.length === 3){
        const poem = poemFromWords(SON_PRENOM, words);
        typeInto(poemBox, poem, 12, ()=>{});
        toFinalBtn.style.display = "block";
      } else {
        poemBox.textContent = "‚Ä¶";
        toFinalBtn.style.display = "none";
      }
    }

    chips.querySelectorAll(".chip").forEach(chip=>{
      chip.onclick = () => {
        const w = chip.getAttribute("data-w");
        const isSel = chip.classList.contains("selected");

        if(isSel){
          chip.classList.remove("selected");
          words = words.filter(x => x !== w);
        } else {
          if(words.length >= 3) return;
          chip.classList.add("selected");
          words.push(w);
        }
        count.textContent = `${words.length} / 3 s√©lectionn√©s`;
        refreshPoem();
      thinkSound();
      };
    });

    function thinkSound(){
      if(isSoundOn && osc){
        const base = 174 + (words.length * 18);
        osc.frequency.setTargetAtTime(base, audioCtx.currentTime, 0.08);
      }
    }

    toFinalBtn.onclick = showFinal;
  }

  function showFinal(){
    step = 2;
    stagePill.textContent = "üå∏ Derni√®re page";
    hintEl.textContent = "";

    const poem = poemFromWords(SON_PRENOM, words);

    screen.innerHTML = `
      <div class="title">Derni√®re page‚Ä¶</div>
      <div class="text" id="finalBox"></div>
      <div class="grid">
        <button class="btnSoft" id="copyBtn">Copier le po√®me</button>
        <button class="main" id="replayBtn">Rejouer</button>
      </div>
      <div class="progress">Un instant qui reste‚Ä¶ comme un parfum sur une √©charpe.</div>
    `;

    const finalBox = document.getElementById("finalBox");
    const finalText =
`${poem}\n\n` +
`Ce moment n‚Äôattend rien.\n` +
`Il existe simplement.\n\n` +
`Pour te laisser quelque chose de rare :\n` +
`un instant qui reste‚Ä¶\n` +
`comme un parfum sur une √©charpe.`;

    typeInto(finalBox, finalText, 12, ()=>{});

    document.getElementById("copyBtn").onclick = async () => {
      try{
        await navigator.clipboard.writeText(finalText);
        alert("Po√®me copi√© ‚úÖ");
      }catch(e){
        alert("Impossible de copier automatiquement.");
      }
    };

    document.getElementById("replayBtn").onclick = showHome;
  }

  // √©toiles
  const symbols = ["‚ú¶","‚úß","‚ú∫","‚ú∂"];
  for(let k=0; k<12; k++){
    const s = document.createElement("div");
    s.className = "star";
    s.textContent = symbols[Math.floor(Math.random()*symbols.length)];
    s.style.left = Math.random()*100 + "vw";
    s.style.animationDuration = (3 + Math.random()*5) + "s";
    s.style.fontSize = (10 + Math.random()*20) + "px";
    s.style.opacity = (0.07 + Math.random()*0.12).toFixed(2);
    document.body.appendChild(s);
  }

  showHome();
</script>
</body>
</html>
