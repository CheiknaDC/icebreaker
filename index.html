<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Un po√®me ‚ú®</title>

<style>
  :root{
    --bg1:#1e293b;
    --bg2:#020617;
    --glass: rgba(255,255,255,0.06);
    --border: rgba(255,255,255,0.12);
    --shadow: 0 22px 70px rgba(0,0,0,0.65);
  }

  body{
    margin:0;
    font-family:-apple-system, system-ui;
    background: radial-gradient(circle at top, var(--bg1), var(--bg2));
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
  }

  .container{
    width:92%;
    max-width:680px;
    background: var(--glass);
    padding:26px;
    border-radius:22px;
    text-align:center;
    box-shadow: var(--shadow);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border);
    position: relative;
  }

  .topbar{
    display:flex;
    justify-content:space-between;
    gap:10px;
    align-items:center;
    margin-bottom:10px;
  }

  .pill{
    display:inline-flex;
    gap:8px;
    align-items:center;
    padding:7px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(0,0,0,.18);
    font-size:12px;
    opacity:.9;
  }

  .soundBtn{
    padding:8px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,0.10);
    color:white;
    cursor:pointer;
    font-size:12px;
    transition:.18s;
  }
  .soundBtn:hover{ background: rgba(255,255,255,0.14); transform: translateY(-1px); }

  .title{
    font-size:34px;
    margin: 6px 0 10px;
    min-height:48px;
    text-shadow: 0 0 12px rgba(255,255,255,0.45);
    animation: glow 1.6s ease-in-out infinite alternate;
  }
  @keyframes glow{
    from{ text-shadow: 0 0 10px rgba(255,255,255,0.22); }
    to{ text-shadow: 0 0 22px rgba(255,255,255,0.70); }
  }

  .text{
    line-height:1.75;
    font-size:16px;
    opacity:0;
    transition:opacity .35s;
    white-space:pre-wrap;
    min-height: 180px;
  }

  .hint{
    margin-top: 8px;
    opacity: .72;
    font-size: 12px;
  }

  .chips{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
    margin-top:12px;
  }
  .chip{
    padding:10px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,0.16);
    background: rgba(255,255,255,0.08);
    cursor:pointer;
    font-size:14px;
    transition:.15s;
    user-select:none;
  }
  .chip:hover{ background: rgba(255,255,255,0.12); transform: translateY(-1px); }
  .chip.selected{
    background: rgba(34,197,94,0.18);
    border-color: rgba(34,197,94,0.35);
  }

  .grid{
    display:grid;
    gap:10px;
    margin-top:14px;
  }

  button.main{
    width:100%;
    padding:14px 14px;
    border-radius:14px;
    border:none;
    background:white;
    color:black;
    font-size:16px;
    cursor:pointer;
    transition:0.18s;
  }
  button.main:hover{ background:#e2e8f0; transform:scale(1.01); }

  .btnGreen{
    width:100%;
    padding:14px 14px;
    border-radius:14px;
    background: rgba(34,197,94,0.20);
    color: white;
    border: 1px solid rgba(34,197,94,0.35);
    font-weight: 700;
    cursor:pointer;
    transition:.18s;
    font-size:16px;
  }
  .btnGreen:hover{ background: rgba(34,197,94,0.28); transform:scale(1.01); }

  .tiny{ font-size: 12px; opacity: .75; margin-top: 6px; }

  .star{
    position:absolute;
    color:white;
    animation: float 6s infinite linear;
    opacity:0.12;
    user-select:none;
    pointer-events:none;
  }
  @keyframes float{
    from{ transform:translateY(110vh); }
    to{ transform:translateY(-15vh); }
  }
</style>
</head>

<body>
<div class="container">
  <div class="topbar">
    <div class="pill" id="stagePill">üìù Po√®me</div>
    <button class="soundBtn" id="soundBtn">üîä Activer le son</button>
  </div>

  <div class="title" id="title"></div>
  <div class="text" id="text"></div>

  <div id="extra"></div>

  <div class="grid">
    <button class="main" id="btn" style="display:none">Voir la derni√®re page</button>
  </div>

  <div class="hint" id="hint"></div>
</div>

<script>
  const SON_PRENOM = "Bambi";

  const stagePill = document.getElementById("stagePill");
  const titleEl = document.getElementById("title");
  const textEl  = document.getElementById("text");
  const btnEl   = document.getElementById("btn");
  const extraEl = document.getElementById("extra");
  const hintEl  = document.getElementById("hint");
  const soundBtn = document.getElementById("soundBtn");

  let step = 0;
  let words = [];

  // --- Son optionnel ---
  let audioCtx = null, osc = null, gain = null, isSoundOn = false;

  function startSound(){
    if(isSoundOn) return;
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    osc = audioCtx.createOscillator();
    gain = audioCtx.createGain();
    osc.type = "sine";
    osc.frequency.value = 174;
    gain.gain.value = 0.00001;
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start();
    const now = audioCtx.currentTime;
    gain.gain.setValueAtTime(0.00001, now);
    gain.gain.linearRampToValueAtTime(0.02, now + 0.28);
    isSoundOn = true;
    soundBtn.textContent = "üîá Couper le son";
  }
  function stopSound(){
    if(!isSoundOn) return;
    try{
      const now = audioCtx.currentTime;
      gain.gain.setValueAtTime(gain.gain.value, now);
      gain.gain.linearRampToValueAtTime(0.00001, now + 0.22);
      setTimeout(()=>{
        if(osc){ osc.stop(); osc.disconnect(); }
        if(gain){ gain.disconnect(); }
        osc=null; gain=null;
      }, 250);
    }catch(e){}
    isSoundOn=false;
    soundBtn.textContent="üîä Activer le son";
  }
  soundBtn.onclick = async () => {
    if(!isSoundOn){
      startSound();
      if(audioCtx && audioCtx.state === "suspended") await audioCtx.resume();
    } else stopSound();
  };

  function fadeText(txt){
    textEl.style.opacity = 0;
    setTimeout(()=>{ textEl.textContent = txt; textEl.style.opacity = 1; }, 70);
  }

  // ‚úÖ M√©taphores coh√©rentes (adapt√©es au mot)
  function metaphorFor(word){
    const w = (word || "").toLowerCase();
    const map = {
      "romantique": "comme une lettre scell√©e qu‚Äôon ouvre lentement",
      "loyale": "comme une main qui ne l√¢che pas, m√™me quand la nuit tombe",
      "douce": "comme une pluie ti√®de qui apaise sans faire de bruit",
      "myst√©rieuse": "comme une lueur derri√®re un rideau, qu‚Äôon devine sans la saisir",
      "solaire": "comme un matin clair qui r√©chauffe tout autour de lui",
      "√©l√©gante": "comme un parfum rare, discret mais inoubliable",
      "spontan√©e": "comme un √©clat de rire qui arrive sans pr√©venir",
      "calme": "comme un lac tranquille o√π l‚Äôon respire mieux",
      "rieuse": "comme une lumi√®re qui danse sur les murs",
      "intense": "comme un feu doux qui ne s‚Äô√©teint pas",
      "curieuse": "comme une porte entrouverte sur mille possibles",
      "audacieuse": "comme un pas en avant, m√™me quand le c≈ìur h√©site",
      "sensible": "comme une peau qui ressent le monde plus fort",
      "sereine": "comme une paix qu‚Äôon n‚Äôexplique pas, qu‚Äôon reconna√Æt",
      "magn√©tique": "comme une gravit√© discr√®te qui attire sans effort",
      "vraie": "comme un regard franc, sans masque et sans d√©tour"
    };
    return map[w] || "comme un secret qu‚Äôon garde au creux de la nuit";
  }

  function poemFromWords(name, words){
    const pick = (i, fallback) => (words[i] ? words[i].toLowerCase() : fallback);

    const w1 = pick(0, "romantique");
    const w2 = pick(1, "myst√©rieuse");
    const w3 = pick(2, "douce");

    const m1 = metaphorFor(w1);
    const m2 = metaphorFor(w2);
    const m3 = metaphorFor(w3);

    return `${name},\n\n` +
`Tu es ${w1} ‚Äî ${m1}.\n` +
`Tu es ${w2} ‚Äî ${m2}.\n` +
`Et ${w3}‚Ä¶ ${m3}.\n\n` +
`Trois mots‚Ä¶\n` +
`et mon silence devient une lettre.\n` +
`Trois mots‚Ä¶\n` +
`et l‚Äôinstant prend ton parfum.`;
  }

  // --- UI ---
  function typeName(){
    const name = SON_PRENOM + "...";
    titleEl.textContent = "";
    let i = 0;
    (function tick(){
      if(i < name.length){
        titleEl.textContent += name[i++];
        setTimeout(tick, 80);
      } else {
        showPoemScreen();
      }
    })();
  }

  function showPoemScreen(){
    step = 0;
    stagePill.textContent = "üìù";
    hintEl.textContent = "Choisis 3 mots. Le po√®me se cr√©e tout seul.";
    btnEl.style.display = "none";
    words = [];

    fadeText(
`J‚Äôai pens√© √† toi.\n\n` +
`Choisis trois mots.\n` +
`Je les transformerai en po√©sie.`
    );

    const pool = [
      "Romantique","Myst√©rieuse","Douce","Solaire","√âl√©gante","Spontan√©e",
      "Calme","Rieuse","Intense","Loyale","Curieuse","Audacieuse",
      "Sensible","Sereine","Magn√©tique","Vraie"
    ];

    extraEl.innerHTML = `
      <div class="chips" id="chips"></div>
      <div class="tiny" id="count">0 / 3 s√©lectionn√©s</div>
    `;

    const chips = document.getElementById("chips");
    const count = document.getElementById("count");
    chips.innerHTML = pool.map(w => `<div class="chip" data-w="${w}">${w}</div>`).join("");

    chips.querySelectorAll(".chip").forEach(chip=>{
      chip.onclick = () => {
        const w = chip.getAttribute("data-w");
        const isSel = chip.classList.contains("selected");

        if(isSel){
          chip.classList.remove("selected");
          words = words.filter(x => x !== w);
        } else {
          if(words.length >= 3) return;
          chip.classList.add("selected");
          words.push(w);
        }

        count.textContent = `${words.length} / 3 s√©lectionn√©s`;

        if(words.length === 3){
          const poem = poemFromWords(SON_PRENOM, words);
          fadeText(poem);
          btnEl.style.display = "block";
        } else {
          btnEl.style.display = "none";
        }
      };
    });
  }

  function showLastPage(){
    step = 1;
    stagePill.textContent = "üå∏ Fin";
    titleEl.textContent = "Derni√®re page‚Ä¶";
    hintEl.textContent = "";
    btnEl.style.display = "none";

    const poem = poemFromWords(SON_PRENOM, words);

    fadeText(
`${poem}\n\n` +
`Ce moment n‚Äôattend rien.\n` +
`Il existe simplement.\n\n` +
`Pour te laisser quelque chose de rare :\n` +
`un instant qui reste‚Ä¶\n` +
`comme un parfum sur une √©charpe.`
    );

    extraEl.innerHTML = `
      <div class="grid">
        <button class="btnGreen" id="replayBtn">Rejouer</button>
      </div>
      <div class="tiny">Rejouer change les mots‚Ä¶ et la po√©sie.</div>
    `;

    document.getElementById("replayBtn").onclick = () => {
      titleEl.textContent = "";
      extraEl.innerHTML = "";
      typeName();
    };
  }

  btnEl.onclick = () => showLastPage();

  // --- √©toiles ---
  const symbols = ["‚ú¶","‚úß","‚ú∫","‚ú∂"];
  for(let k=0; k<12; k++){
    const s = document.createElement("div");
    s.className = "star";
    s.textContent = symbols[Math.floor(Math.random()*symbols.length)];
    s.style.left = Math.random()*100 + "vw";
    s.style.animationDuration = (3 + Math.random()*5) + "s";
    s.style.fontSize = (10 + Math.random()*20) + "px";
    s.style.opacity = (0.07 + Math.random()*0.12).toFixed(2);
    document.body.appendChild(s);
  }

  // start
  typeName();
</script>
</body>
</html>

